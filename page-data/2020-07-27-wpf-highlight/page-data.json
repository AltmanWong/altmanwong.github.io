{"componentChunkName":"component---src-templates-blog-post-js","path":"/2020-07-27-wpf-highlight/","result":{"data":{"site":{"siteMetadata":{"title":"LAP-TECH"}},"markdownRemark":{"id":"12134f04-2726-5b38-a1fe-f0a38dfc2972","excerpt":"平時我哋讀書個時都會用到瑩光筆去畫起一啲重點，方便以後搵翻啲重點出嚟。嚟到 WPF 嘅世界我哋又點先可以做到瑩光筆嘅效果呢，以下有幾個方法：  入面夾大量嘅 , 而每一個中咗嘅  嘅  就會變成黃色。\n 作為 Parent，中間 Render…","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d670886e9c1dea6c284eca7ea9c9ca78/28be2/cover.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.70270270270271%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAQCBf/EABUBAQEAAAAAAAAAAAAAAAAAAAEA/9oADAMBAAIQAxAAAAHn5nFaiD//xAAaEAACAgMAAAAAAAAAAAAAAAAAEQIDEBIT/9oACAEBAAEFAulhHUVYx4//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAwEBPwGq/8QAFhEBAQEAAAAAAAAAAAAAAAAAABES/9oACAECAQE/AYy//8QAHBAAAQMFAAAAAAAAAAAAAAAAAAIDEiAiMTKB/9oACAEBAAY/At1F0uGXKP/EABwQAAMAAQUAAAAAAAAAAAAAAAABESExQYGR0f/aAAgBAQABPyGXsZnpCuVxtFFXborwf//aAAwDAQACAAMAAAAQdB//xAAXEQEAAwAAAAAAAAAAAAAAAAAAEUFx/9oACAEDAQE/EJWw/8QAGBEAAwEBAAAAAAAAAAAAAAAAAAERIXH/2gAIAQIBAT8QmRYdM//EABsQAQADAQEBAQAAAAAAAAAAAAEAESFRMUFh/9oACAEBAAE/EAhon1exgFaYPb/bngEflCIK57whQ6eI1UozhP/Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"WPF 的瑩光筆\"\n        title=\"WPF 的瑩光筆\"\n        src=\"/static/d670886e9c1dea6c284eca7ea9c9ca78/1c72d/cover.jpg\"\n        srcset=\"/static/d670886e9c1dea6c284eca7ea9c9ca78/a80bd/cover.jpg 148w,\n/static/d670886e9c1dea6c284eca7ea9c9ca78/1c91a/cover.jpg 295w,\n/static/d670886e9c1dea6c284eca7ea9c9ca78/1c72d/cover.jpg 590w,\n/static/d670886e9c1dea6c284eca7ea9c9ca78/28be2/cover.jpg 786w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>平時我哋讀書個時都會用到瑩光筆去畫起一啲重點，方便以後搵翻啲重點出嚟。嚟到 WPF 嘅世界我哋又點先可以做到瑩光筆嘅效果呢，以下有幾個方法：</p>\n<p><code class=\"language-text\">TextBlock</code> 入面夾大量嘅 <code class=\"language-text\">Run</code>, 而每一個中咗嘅 <code class=\"language-text\">Run</code> 嘅 <code class=\"language-text\">Background</code> 就會變成黃色。\n<code class=\"language-text\">WrapPanel</code> 作為 Parent，中間 Render 大量 <code class=\"language-text\">TextBlock</code>，當 <code class=\"language-text\">TextBlock</code> 入面嘅字中左就會變成黃色。\n<code class=\"language-text\">RichTextBox</code> + <code class=\"language-text\">Paragraph</code>\n講多無謂，實戰下先。</p>\n<p>假設我地有 100 段 <code class=\"language-text\">Paragraph</code> (即係下面條 <code class=\"language-text\">string</code>)，我哋要 highlight 個 i 字。</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token class-name\"><span class=\"token keyword\">string</span></span> text <span class=\"token operator\">=</span> <span class=\"token string\">\"Lorem ipsum dolor sit amet, consectetur adipiscing elit ... ullamcorper pulvinar tellus.\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">Regex</span> keywordMatchingRegex <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">Regex</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"i\"</span><span class=\"token punctuation\">,</span> RegexOptions<span class=\"token punctuation\">.</span>IgnoreCase<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>用我哋上面所寫嘅方法去 Render 可以得出以下嘅 Code</p>\n<p>(1) <code class=\"language-text\">TextBlock</code> 夾 <code class=\"language-text\">Run</code></p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token class-name\">TextBlock</span> textBlock <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">TextBlock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n \n<span class=\"token class-name\"><span class=\"token keyword\">int</span></span> lastPt <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">List<span class=\"token punctuation\">&lt;</span>Run<span class=\"token punctuation\">></span></span> listOfRun <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">List<span class=\"token punctuation\">&lt;</span>Run<span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n \n<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>keywordMatchingRegex<span class=\"token punctuation\">.</span>Length <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    listOfRun<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        Text <span class=\"token operator\">=</span> text<span class=\"token punctuation\">.</span><span class=\"token function\">SubString</span><span class=\"token punctuation\">(</span>lastPt<span class=\"token punctuation\">,</span> keywordMatchingRegex<span class=\"token punctuation\">.</span>Index <span class=\"token operator\">-</span> keywordMatchingRegex<span class=\"token punctuation\">.</span>Length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n \n    listOfRun<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        Text <span class=\"token operator\">=</span> keywordMatchingRegex<span class=\"token punctuation\">.</span>Value<span class=\"token punctuation\">,</span>\n        Background <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">SolidColorBrush</span><span class=\"token punctuation\">(</span>Colors<span class=\"token punctuation\">.</span>Yellow<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>    \n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n \n    lastPt <span class=\"token operator\">=</span> keywordMatchingRegex<span class=\"token punctuation\">.</span>Index <span class=\"token operator\">+</span> keywordMatchingRegex<span class=\"token punctuation\">.</span>Length<span class=\"token punctuation\">;</span>\n    keywordMatchingRegex <span class=\"token operator\">=</span> keywordMatchingRegex<span class=\"token punctuation\">.</span><span class=\"token function\">Next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n \nlistOfRun<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    Text <span class=\"token operator\">=</span> text<span class=\"token punctuation\">.</span><span class=\"token function\">SubString</span><span class=\"token punctuation\">(</span>lastPt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n \ntextBlock<span class=\"token punctuation\">.</span>Inlines<span class=\"token punctuation\">.</span><span class=\"token function\">Clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ntextBlock<span class=\"token punctuation\">.</span>Inlines<span class=\"token punctuation\">.</span><span class=\"token function\">AddRange</span><span class=\"token punctuation\">(</span>listOfRun<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>(2) <code class=\"language-text\">WrapPanel</code> 夾 <code class=\"language-text\">TextBlock</code></p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token class-name\">WrapPanel</span> wrapPanel <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">WrapPanel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    Orientation <span class=\"token operator\">=</span> Orientation<span class=\"token punctuation\">.</span>Horizontal\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n \n<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>keywordMatchingRegex<span class=\"token punctuation\">.</span>Length <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    wrapPanel<span class=\"token punctuation\">.</span>Children<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">TextBlock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        Text <span class=\"token operator\">=</span> unmatchedText<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n \n    wrapPanel<span class=\"token punctuation\">.</span>Children<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">TextBlock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        Text <span class=\"token operator\">=</span> keywordMatchingRegex<span class=\"token punctuation\">.</span>Value<span class=\"token punctuation\">,</span>\n        Background <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">SolidColorBrush</span><span class=\"token punctuation\">(</span>Colors<span class=\"token punctuation\">.</span>Yellow<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>    \n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n \n    lastPt <span class=\"token operator\">=</span> keywordMatchingRegex<span class=\"token punctuation\">.</span>Index <span class=\"token operator\">+</span> keywordMatchingRegex<span class=\"token punctuation\">.</span>Length<span class=\"token punctuation\">;</span>\n    keywordMatchingRegex <span class=\"token operator\">=</span> keywordMatchingRegex<span class=\"token punctuation\">.</span><span class=\"token function\">Next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n \nwrapPanel<span class=\"token punctuation\">.</span>Children<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">TextBlock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    Text <span class=\"token operator\">=</span> text<span class=\"token punctuation\">.</span><span class=\"token function\">SubString</span><span class=\"token punctuation\">(</span>lastPt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>(3) <code class=\"language-text\">RichTextBox</code> 夾 <code class=\"language-text\">Paragraph</code> 夾 <code class=\"language-text\">Run</code></p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token class-name\">RichTextBox</span> richTextBox <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">RichTextBox</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">Paragraph</span> p <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">Paragraph</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n \n<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>keywordMatchingRegex<span class=\"token punctuation\">.</span>Length <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    p<span class=\"token punctuation\">.</span>Inlines<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        Text <span class=\"token operator\">=</span> unmatchedText<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n \n    p<span class=\"token punctuation\">.</span>Inlines<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        Text <span class=\"token operator\">=</span> keywordMatchingRegex<span class=\"token punctuation\">.</span>Value<span class=\"token punctuation\">,</span>\n        Background <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">SolidColorBrush</span><span class=\"token punctuation\">(</span>Colors<span class=\"token punctuation\">.</span>Yellow<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>    \n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n \n    lastPt <span class=\"token operator\">=</span> keywordMatchingRegex<span class=\"token punctuation\">.</span>Index <span class=\"token operator\">+</span> keywordMatchingRegex<span class=\"token punctuation\">.</span>Length<span class=\"token punctuation\">;</span>\n    keywordMatchingRegex <span class=\"token operator\">=</span> keywordMatchingRegex<span class=\"token punctuation\">.</span><span class=\"token function\">Next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n \np<span class=\"token punctuation\">.</span>Inlines<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    Text <span class=\"token operator\">=</span> text<span class=\"token punctuation\">.</span><span class=\"token function\">SubString</span><span class=\"token punctuation\">(</span>lastPt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n \nrichTextBox<span class=\"token punctuation\">.</span>Document<span class=\"token punctuation\">.</span>Blocks<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>其實三個方法表面上都好似，只係用上唔同既 <code class=\"language-text\">UI-Element</code> Display 出黎，但 Performance 上可以話係差天共地！我地可以睇下下面嘅 benchmark result．</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>TextBlock + Run</th>\n<th>WrapPanel + TextBlock</th>\n<th>RichTextBox + Paragraph</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Elapsed Time (ms)</td>\n<td>564</td>\n<td>707</td>\n<td>382</td>\n</tr>\n</tbody>\n</table>\n<p>從以上嘅數據可以睇得出 <code class=\"language-text\">RichTextBox</code> 喺 Performance 上面真係完全佔優！</p>","frontmatter":{"title":"WPF 的瑩光筆","date":"July 27, 2020"}}},"pageContext":{"slug":"/2020-07-27-wpf-highlight/","previous":{"fields":{"slug":"/2020-07-22-wpf-multi-ui-element-rendering/"},"frontmatter":{"title":"大量渲染 UI Element"}},"next":{"fields":{"slug":"/2020-07-30-wpf-binding-performance/"},"frontmatter":{"title":"WPF Binding performance"}}}}}