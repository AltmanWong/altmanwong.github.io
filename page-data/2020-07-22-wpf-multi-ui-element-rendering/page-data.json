{"componentChunkName":"component---src-templates-blog-post-js","path":"/2020-07-22-wpf-multi-ui-element-rendering/","result":{"data":{"site":{"siteMetadata":{"title":"LAP-TECH"}},"markdownRemark":{"id":"e93eb502-845e-50e5-86cb-f6e349dab30a","excerpt":"假設我哋依家有一隻咁樣嘅  叫 ，我哋可以啪個  同  入去比佢 Display，從而得出下圖嘅效果。 如果我哋想 Generate 多個以上嘅  嘅話，有以下幾個方法。 直接打晒出嚟，人手啪晒啲 Key-Value 上去 喺  入面 Gen 條 ，然後喺 xaml 入面用  Generate…","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8b6f81e0b06f0240692117db128d9afc/28be2/cover.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.70270270270271%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAT/xAAXAQADAQAAAAAAAAAAAAAAAAAAAQIE/9oADAMBAAIQAxAAAAGkTmAf/8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQABBQJf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAGBAAAgMAAAAAAAAAAAAAAAAAABABIUH/2gAIAQEAAT8hV44P/9oADAMBAAIAAwAAABAUD//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAEDAQE/EEf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAbEAACAgMBAAAAAAAAAAAAAAAAQQERgcHwkf/aAAgBAQABPxDu9LZTBY0POyU0f//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"UI Element大爆炸\"\n        title=\"UI Element大爆炸\"\n        src=\"/static/8b6f81e0b06f0240692117db128d9afc/1c72d/cover.jpg\"\n        srcset=\"/static/8b6f81e0b06f0240692117db128d9afc/a80bd/cover.jpg 148w,\n/static/8b6f81e0b06f0240692117db128d9afc/1c91a/cover.jpg 295w,\n/static/8b6f81e0b06f0240692117db128d9afc/1c72d/cover.jpg 590w,\n/static/8b6f81e0b06f0240692117db128d9afc/28be2/cover.jpg 786w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>假設我哋依家有一隻咁樣嘅 <code class=\"language-text\">UI-Element</code> 叫 <code class=\"language-text\">SubControlUserControl</code>，我哋可以啪個 <code class=\"language-text\">Key</code> 同 <code class=\"language-text\">Value</code> 入去比佢 Display，從而得出下圖嘅效果。</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>DockPanel</span> <span class=\"token attr-name\">Width</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>100<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Margin</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>2<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>DockPanel.Resources</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Style</span> <span class=\"token attr-name\">TargetType</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>TextBlock<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Setter</span> <span class=\"token attr-name\">Property</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Padding<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Value</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>2<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Setter</span> <span class=\"token attr-name\">Property</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Foreground<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Value</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>White<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Style</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>DockPanel.Resources</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>TextBlock</span>\n        <span class=\"token attr-name\">DockPanel.Dock</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Right<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Background</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>SeaGreen<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">MinWidth</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>30<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">TextAlignment</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Right<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\">Text</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>{Binding Path=Value, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=UserControl}, StringFormat=${0:0}}<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>TextBlock</span>\n        <span class=\"token attr-name\">Text</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>{Binding Path=Key, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=UserControl}, Mode=OneWay}<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\">DockPanel.Dock</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Left<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Background</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>MediumSeaGreen<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>DockPanel</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>如果我哋想 Generate 多個以上嘅 <code class=\"language-text\">UI-Element</code> 嘅話，有以下幾個方法。</p>\n<ol>\n<li>直接打晒出嚟，人手啪晒啲 Key-Value 上去</li>\n<li>喺 <code class=\"language-text\">ViewModel</code> 入面 Gen 條 <code class=\"language-text\">List</code>，然後喺 xaml 入面用 <code class=\"language-text\">ItemsControl</code> Generate 翻個 <code class=\"language-text\">UI-Element</code> 出嚟</li>\n<li>直接喺 <code class=\"language-text\">ViewModel</code> 入面 Gen 個 <code class=\"language-text\">Panel</code>，然後直接啪個 <code class=\"language-text\">UI-Element</code> 入去 <code class=\"language-text\">Panel.Children</code> 入面</li>\n</ol>\n<p>辦法總比困難多，但邊個方法先係最好呢？我哋實戰試一試。</p>\n<p>以下我會用一個 <code class=\"language-text\">WrapPanel</code> 去儲著 1000 個上面嘅 <code class=\"language-text\">UI-Element</code>。</p>\n<p>(1) 比較簡單，同時都會寫爛 Code，所以不作考慮。</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>WrapPanel</span> <span class=\"token attr-name\">Orientation</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Horizontal<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token comment\">&lt;!-- Repeat this line for 1000 times --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token namespace\">RenderTest:</span>SubControlUserControl</span> <span class=\"token attr-name\">Key</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Price<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Value</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>1000<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>WrapPanel</span><span class=\"token punctuation\">></span></span> </code></pre></div>\n<p>(2) 就用到 <code class=\"language-text\">ItemsControl</code> 去 <code class=\"language-text\">Bind</code> 一條有著唔同 Key-Value data 嘅 <code class=\"language-text\">List</code>，然後係ItemsControl.ItemsTemplate 入面 Call 上面嘅 <code class=\"language-text\">UI-Element</code>，再 <code class=\"language-text\">Bind</code> 埋條 <code class=\"language-text\">List</code> 入面嘅 Data。</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ItemsControl</span> <span class=\"token attr-name\">ItemsSource</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>{Binding Path=ListOfItemsToBeRender, Mode=OneWay}<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ItemsControl.ItemsPanel</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ItemsPanelTemplate</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>WrapPanel</span> <span class=\"token attr-name\">Orientation</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Horizontal<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ItemsPanelTemplate</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ItemsControl.ItemsPanel</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ItemsControl.ItemTemplate</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>DataTemplate</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token namespace\">RenderTest:</span>SubControlUserControl</span> <span class=\"token attr-name\">Key</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Price<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Value</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>1000<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>DataTemplate</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ItemsControl.ItemTemplate</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ItemsControl</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>(3) 就直接 Call 一個 <code class=\"language-text\">ContentControl</code> <code class=\"language-text\">Bind</code> 著 <code class=\"language-text\">ViewModel</code> 入面嘅 <code class=\"language-text\">UI-Element</code>。喺 <code class=\"language-text\">ViewModel</code> 入面直接 Create 1000 隻 <code class=\"language-text\">SubControlUserControl</code>，同時啪定唔同嘅 Key-Value 入去比佢食。</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ContentControl</span> <span class=\"token attr-name\">Content</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>{Binding Path=ContentControl, Mode=OneWay}<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ViewModel</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token function\">ViewModel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">WrapPanel</span> panel <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">WrapPanel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n \n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">int</span></span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            panel<span class=\"token punctuation\">.</span>Children<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">SubControlUserControl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Price\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n \n        ContentControl <span class=\"token operator\">=</span> panel<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n \n    <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\">UIElement</span> ContentControl <span class=\"token punctuation\">{</span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">set</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>以上三個方法嘅成效如下：</p>\n<table>\n<thead>\n<tr>\n<th>運行時間 (ms)</th>\n<th>(1) Direct Render</th>\n<th>(2) ItemsControl</th>\n<th>(3) ContentControl</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>100</td>\n<td>38</td>\n<td>106</td>\n<td>47</td>\n</tr>\n<tr>\n<td>1000</td>\n<td>217</td>\n<td>1103</td>\n<td>260</td>\n</tr>\n<tr>\n<td>10000</td>\n<td>2656</td>\n<td>12249</td>\n<td>2985</td>\n</tr>\n</tbody>\n</table>\n<p>從以上嘅結果可以睇得出用 <code class=\"language-text\">ItemsControl</code> 會嚴重拖慢 Render 進程，但同時間 Direct Render 又會影響到 code readability。唯有取中庸之道係 <code class=\"language-text\">ViewModel</code> 層面預先砌好晒成個 <code class=\"language-text\">WrapPanel</code>, 再係 <code class=\"language-text\">xaml</code> 入面用 <code class=\"language-text\">ContentControl</code> 去 Call 個 <code class=\"language-text\">Panel</code> 出嚟。</p>","frontmatter":{"title":"大量渲染 UI Element","date":"July 22, 2020"}}},"pageContext":{"slug":"/2020-07-22-wpf-multi-ui-element-rendering/","previous":null,"next":{"fields":{"slug":"/2020-07-27-wpf-highlight/"},"frontmatter":{"title":"WPF 的瑩光筆"}}}}}