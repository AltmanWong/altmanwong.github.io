{"componentChunkName":"component---src-templates-blog-post-js","path":"/2020-08-03-wpf-richtextbox-hyperlink/","result":{"data":{"site":{"siteMetadata":{"title":"LAP-TECH"}},"markdownRemark":{"id":"31835cd9-28e2-5035-b7b9-5e2bd9b1bdc6","excerpt":"以下有一段  嘅 Code 就咁睇唔會有咩野大問題, 一樣可以 Click 到 highlight 到, 不過一到 Copy 個時就會 throw exception 原因係佢當個Command係個String, 而   係會炒粉 係要用到 Command 又要比 User Highlight & Copy…","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/073c2e7bbd7cde4c538b3f27a553ac34/28be2/cover.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.70270270270271%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAEDBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHhXMlQv//EABgQAAIDAAAAAAAAAAAAAAAAAAABERIg/9oACAEBAAEFAoKoeP/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABcQAAMBAAAAAAAAAAAAAAAAAAABMiD/2gAIAQEABj8CpFLP/8QAGBABAQEBAQAAAAAAAAAAAAAAAREAIPD/2gAIAQEAAT8hDDHjcIy3j//aAAwDAQACAAMAAAAQjA//xAAXEQADAQAAAAAAAAAAAAAAAAABEBFR/9oACAEDAQE/EIdX/8QAFxEAAwEAAAAAAAAAAAAAAAAAARARUf/aAAgBAgEBPxCjF//EAB0QAQACAAcAAAAAAAAAAAAAAAEAESAhMUGh0fD/2gAIAQEAAT8QWlNlo3lxPR0gOADc0cH/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"如何避免 RichTextBox Hyperlink Copy throw exception\"\n        title=\"如何避免 RichTextBox Hyperlink Copy throw exception\"\n        src=\"/static/073c2e7bbd7cde4c538b3f27a553ac34/1c72d/cover.jpg\"\n        srcset=\"/static/073c2e7bbd7cde4c538b3f27a553ac34/a80bd/cover.jpg 148w,\n/static/073c2e7bbd7cde4c538b3f27a553ac34/1c91a/cover.jpg 295w,\n/static/073c2e7bbd7cde4c538b3f27a553ac34/1c72d/cover.jpg 590w,\n/static/073c2e7bbd7cde4c538b3f27a553ac34/28be2/cover.jpg 786w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>以下有一段 <code class=\"language-text\">RichTextBox</code> 嘅 Code</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>RichTextBox</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Paragraph</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Hyperlink</span>\n      <span class=\"token attr-name\">Command</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span>{Binding</span> <span class=\"token attr-name\">Path</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span>OnHyperlinkClickedCommand}</span>\n      <span class=\"token attr-name\">CommandParameter</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Some Parameter<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Run</span> <span class=\"token attr-name\">Text</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Click Here!<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Hyperlink</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Paragraph</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>RichTextBox</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>就咁睇唔會有咩野大問題, 一樣可以 Click 到 highlight 到, 不過一到 Copy 個時就會 throw exception</p>\n<p>原因係佢當個Command係個String, 而 <code class=\"language-text\">Command</code> <code class=\"language-text\">ToString</code> 係會炒粉</p>\n<p>係要用到 Command 又要比 User Highlight &#x26; Copy 嘅情況下 我地就要用啲小聰明去解決佢。</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HyperlinkBehavior</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">readonly</span> <span class=\"token class-name\">DependencyProperty</span> CopibleCommandProperty <span class=\"token operator\">=</span> DependencyProperty<span class=\"token punctuation\">.</span><span class=\"token function\">RegisterAttached</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"CopibleCommand\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">typeof</span><span class=\"token punctuation\">(</span><span class=\"token type-expression class-name\">ICommand</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">typeof</span><span class=\"token punctuation\">(</span><span class=\"token type-expression class-name\">HyperlinkBehavior</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">PropertyMetadata</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> OnCopibleCommandChange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">SetCopibleCommand</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">DependencyObject</span> dependencyObject<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ICommand</span> <span class=\"token keyword\">value</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">{</span>\n    dependencyObject<span class=\"token punctuation\">.</span><span class=\"token function\">SetValue</span><span class=\"token punctuation\">(</span>CopibleCommandProperty<span class=\"token punctuation\">,</span> <span class=\"token keyword\">value</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\">ICommand</span> <span class=\"token function\">GetCopibleCommand</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">DependencyObject</span> dependencyObject<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>ICommand<span class=\"token punctuation\">)</span>dependencyObject<span class=\"token punctuation\">.</span><span class=\"token function\">GetValue</span><span class=\"token punctuation\">(</span>CopibleCommandProperty<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">OnCopibleCommandChange</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">DependencyObject</span> d<span class=\"token punctuation\">,</span> <span class=\"token class-name\">DependencyPropertyChangedEventArgs</span> e<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token class-name\">Hyperlink</span> link <span class=\"token operator\">=</span> d <span class=\"token keyword\">as</span> <span class=\"token class-name\">Hyperlink</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>link <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">{</span>\n        link<span class=\"token punctuation\">.</span>Click <span class=\"token operator\">-=</span> ClickHandler<span class=\"token punctuation\">;</span>\n        link<span class=\"token punctuation\">.</span>Click <span class=\"token operator\">+=</span> ClickHandler<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n      Console<span class=\"token punctuation\">.</span><span class=\"token function\">WriteLine</span><span class=\"token punctuation\">(</span>ex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">ClickHandler</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">object</span></span> sender<span class=\"token punctuation\">,</span> <span class=\"token class-name\">RoutedEventArgs</span> e<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Execute function here</span>\n    <span class=\"token class-name\">DependencyObject</span> d <span class=\"token operator\">=</span> sender <span class=\"token keyword\">as</span> <span class=\"token class-name\">DependencyObject</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">GetCopibleCommand</span><span class=\"token punctuation\">(</span>d<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Execute</span><span class=\"token punctuation\">(</span><span class=\"token function\">GetCopibleCommandParameter</span><span class=\"token punctuation\">(</span>d<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">readonly</span> <span class=\"token class-name\">DependencyProperty</span> CopibleCommandParameterProperty <span class=\"token operator\">=</span> DependencyProperty<span class=\"token punctuation\">.</span><span class=\"token function\">RegisterAttached</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"CopibleCommandParameter\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">typeof</span><span class=\"token punctuation\">(</span><span class=\"token type-expression class-name\"><span class=\"token keyword\">string</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">typeof</span><span class=\"token punctuation\">(</span><span class=\"token type-expression class-name\">HyperlinkBehavior</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">SetCopibleCommandParameter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">DependencyObject</span> dependencyObject<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ICommand</span> <span class=\"token keyword\">value</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">{</span>\n    dependencyObject<span class=\"token punctuation\">.</span><span class=\"token function\">SetValue</span><span class=\"token punctuation\">(</span>CopibleCommandProperty<span class=\"token punctuation\">,</span> <span class=\"token keyword\">value</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">string</span></span> <span class=\"token function\">GetCopibleCommandParameter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">DependencyObject</span> dependencyObject<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">string</span><span class=\"token punctuation\">)</span>dependencyObject<span class=\"token punctuation\">.</span><span class=\"token function\">GetValue</span><span class=\"token punctuation\">(</span>CopibleCommandParameterProperty<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>冇錯就係萬能嘅 <code class=\"language-text\">Behavior</code>！上面嘅 class 有兩個 Property，分別係 <code class=\"language-text\">CopibleCommand</code> 同埋 <code class=\"language-text\">CopibleCommandParameter</code>。</p>\n<p><code class=\"language-text\">CopibleCommand</code> 就 Bind 番平時用開嘅 <code class=\"language-text\">Command</code>，然後就 <code class=\"language-text\">Listen</code> 著個 <code class=\"language-text\">Click Event</code>．當 User Click 中個 Hyperlink 個時就連埋個 <code class=\"language-text\">CopibleCommandParameter</code> Fire 個 <code class=\"language-text\">CopibleCommand</code> 出黎。咁就可以避咗 Copy 個時指咗去本身個 <code class=\"language-text\">Command</code> 嘅問題喇。</p>","frontmatter":{"title":"如何避免 RichTextBox Hyperlink Copy throw exception","date":"August 03, 2020"}}},"pageContext":{"slug":"/2020-08-03-wpf-richtextbox-hyperlink/","previous":{"fields":{"slug":"/2020-07-30-wpf-binding-performance/"},"frontmatter":{"title":"WPF Binding performance"}},"next":{"fields":{"slug":"/2020-08-06-wpf-radiobutton-binding/"},"frontmatter":{"title":"WPF RadioButton Binding 方法"}}}}}